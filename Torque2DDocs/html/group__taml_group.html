<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Torque2D Reference: TAML Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="t2d-stylesheet-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Torque2D Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle"><div class="title">TAML Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_binary_reader.html">TamlBinaryReader</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_binary_writer.html">TamlBinaryWriter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_j_s_o_n_parser.html">TamlJSONParser</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">RapidJson.  <a href="class_taml_j_s_o_n_parser.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_j_s_o_n_reader.html">TamlJSONReader</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">RapidJson.  <a href="class_taml_j_s_o_n_reader.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_j_s_o_n_writer.html">TamlJSONWriter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml.html">Taml</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_callbacks.html">TamlCallbacks</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_children.html">TamlChildren</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_custom_field.html">TamlCustomField</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_custom_node.html">TamlCustomNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_custom_nodes.html">TamlCustomNodes</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_parser.html">TamlParser</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_visitor.html">TamlVisitor</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_write_node.html">TamlWriteNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_xml_parser.html">TamlXmlParser</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_xml_reader.html">TamlXmlReader</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_taml_xml_writer.html">TamlXmlWriter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2><a class="anchor" id="autotoc_md27"></a>
Introduction</h2>
<p>TAML is an acronym of <a class="el" href="namespace_torque.html">Torque</a> Application Mark-up Language. It decribes a method of persisting type instances in various output formats. TAML is designed to be extremely easy to use and provides a nice consistent method of persisting information.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Prerequisite Knowledge</h2>
<p>This document assumes knowledge of the [TorqueScript Syntax](TorqueScript-Syntax) only.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
TorqueScript Bindings</h2>
<ul>
<li><a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/persistence/taml/taml_ScriptBinding.h">Taml</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
Starting Out</h2>
<p>TAML was designed to be easy to use and in that sense, the following code should be easy to understand:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out.</span></div>
<div class="line">TamlWrite( %obj, <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="ttc" id="aclass_sprite_html"><div class="ttname"><a href="class_sprite.html">Sprite</a></div><div class="ttdef"><b>Definition</b> Sprite.h:33</div></div>
</div><!-- fragment --><p>This will write the following XML file:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">Sprite</span>/&gt;</div>
</div><!-- fragment --><p>That's pretty simple and shows a basic principle when the output format is XML in that an XML element denotes a type to be created, in this case it's the "Sprite" type. It should also be clear that nothing else related to the "Sprite" has been written. This is another feature that TAML provides in that it allows type designers to specify whether additional state like fields are written or not, typically based upon whether they are at their default values or not.</p>
<p>To read this back in we would use:</p>
<div class="fragment"><div class="line">%obj = TamlRead( <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
</div><!-- fragment --><p>Again, pretty simple. Given the two global functions shown you have nearly everything you need to know to actually use the TAML system because you can both write and read objects.</p>
<p>This document however breaks down TAML into more detail beyond what you may need on a day-to-day basis but also includes information on the structure of its XML format which is an easily editable format to work with.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
TAML instance</h2>
<p>The global functions shown above are simplified ways of writing and reading objects. They are simplified because they hide the fact that TAML is actually a type you can create.</p>
<p>For instance, the previous write and read examples could've been done using the following:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an instance of TAML.</span></div>
<div class="line">%taml = <span class="keyword">new</span> <a class="code hl_class" href="class_taml.html">Taml</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read it in using the same TAML instance.</span></div>
<div class="line">%readObj = %taml.read( <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Delete the instance of Taml.</span></div>
<div class="line">%taml.delete();</div>
<div class="ttc" id="aclass_taml_html"><div class="ttname"><a href="class_taml.html">Taml</a></div><div class="ttdef"><b>Definition</b> taml.h:75</div></div>
</div><!-- fragment --><p>The "TamlWrite()" and "TamlRead()" essentially remove the need to generate a TAML instance and delete if afterwards. Whilst this is convenient in many cases, these functions don't expose all the other features that TAML provides therefore it becomes necesssary to use a TAML instance when you wish to use them.</p>
<p>There is an exception to this, both the "TamlWrite()" and "TamlRead()" support additional arguments to specify the formats to use however that will be covered below.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Multiple formats</h2>
<p>TAML currently supports two named formats of:</p>
<ul>
<li>XML</li>
<li>Binary</li>
</ul>
<p>The XML format offers an easily edited format which is useful during game construction to edit outside of any editor. XML however is more verbose and typically produces larger file sizes however this disadvantage is greatly outweighed by the fact that it is easily editable.</p>
<p>The Binary format is not easily edited but produces smaller file sizes, especially when compression is used.</p>
<p>TAML can easily be extended to support more format types as long as the the format can encapsulate the state that TAML compiles when it analyses an object. Also, all formats must obviously be lossless and produce identical results in that if you were to read from one format and save to another then read that back and save back to the original format, the output should be identical. Currently both the XML and Binary formats strictly adhere to this principle.</p>
<p>There are two ways to select which format to use for writing and reading, one explicit and the other implicit.</p>
<p>Here's a couple of explicit method examples:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an instance of TAML.</span></div>
<div class="line">%taml = <span class="keyword">new</span> <a class="code hl_class" href="class_taml.html">Taml</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the XML format.</span></div>
<div class="line">%taml.Format = Xml;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read it in.</span></div>
<div class="line">%readObj = %taml.read( <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Delete the instance of Taml.</span></div>
<div class="line">%taml.delete();</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an instance of TAML.</span></div>
<div class="line">%taml = <span class="keyword">new</span> <a class="code hl_class" href="class_taml.html">Taml</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the Binary format.</span></div>
<div class="line">%taml.Format = Binary;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.baml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read it in.</span></div>
<div class="line">%readObj = %taml.read( <span class="stringliteral">&quot;stuff.baml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Delete the instance of Taml.</span></div>
<div class="line">%taml.delete();</div>
</div><!-- fragment --><p>As you can see, the format was set using the field "Format" but an alternate is using the method "setFormat()". You can currently specify either "xml" or "binary" for the format. The TAML instance will then use that format for all subsequent write and read operations.</p>
<p>In the examples the extensions ".taml" and ".baml" were used to denote an XML file and a Binary file respectively however these extensions and filenames can be whatever you choose.</p>
<p>Explicit formatting provides very fine control over write and read operations however it's common to not actually know the format but instead establish an extension to denote a format type just like you would expect for other file types.</p>
<p>Implicit formatting also known as "auto format" works without you having to select the format mode. Auto format does this by looking at the specified filename in the write or read operation and uses its extension to determine which format to use.</p>
<p><a class="el" href="class_taml.html">Taml</a> comes with defaults for the filename extensions for both XML and Binary, these being "taml" and "baml" respectively but you are free to change those easily.</p>
<p>Here's an example auto-format:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an instance of TAML.</span></div>
<div class="line">%taml = <span class="keyword">new</span> <a class="code hl_class" href="class_taml.html">Taml</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in XML.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in Binary.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.baml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read it in.</span></div>
<div class="line">%readObj1 = %taml.read( <span class="stringliteral">&quot;stuff.taml&quot;</span> );</div>
<div class="line">%readObj2 = %taml.read( <span class="stringliteral">&quot;stuff.baml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Delete the instance of Taml.</span></div>
<div class="line">%taml.delete();</div>
</div><!-- fragment --><p>As you can see, there's no format specification anywhere. Again, this is because TAML determined that the "taml" extension is associated with XML and the "baml" extension with Binary.</p>
<p>You can change these meanings and reuse a TAML instance if you so desire like so:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an instance of TAML.</span></div>
<div class="line">%taml = <span class="keyword">new</span> <a class="code hl_class" href="class_taml.html">Taml</a>()</div>
<div class="line"> </div>
<div class="line">%taml.AutoFormatXmlExtension = <span class="stringliteral">&quot;xml&quot;</span>;</div>
<div class="line">%taml.AutoFormatBinaryExtension = <span class="stringliteral">&quot;bin&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in XML.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.xml&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in Binary.</span></div>
<div class="line">%taml.write( %obj, <span class="stringliteral">&quot;stuff.bin&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read it in.</span></div>
<div class="line">%readObj1 = %taml.read( <span class="stringliteral">&quot;stuff.xml&quot;</span> );</div>
<div class="line">%readObj2 = %taml.read( <span class="stringliteral">&quot;stuff.bin&quot;</span> );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Delete the instance of Taml.</span></div>
<div class="line">%taml.delete();</div>
</div><!-- fragment --><p>Currently, TAML only supports a single file extension specification but it's a trivial matter to change this to support multiple extensions should it be required.</p>
<p>When using the Binary format you can also specify whether binary compression is used or not. This is used by default and you should not turn it off unless you have a good reason to do so.</p>
<p>It is controlled with the following:</p>
<ul>
<li>setBinaryCompression(true/false)</li>
<li>getBinaryCompression()</li>
<li>"BinaryCompression" field.</li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
TamlRead and TamlWrite</h2>
<p>Given the various methods for explicit and implicit format control, it's worth knowing that the simplified "TamlWrite()" and "TamlRead()" expose the ability to specify an explicit format like so:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a sprite.</span></div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in XML.</span></div>
<div class="line">TamlWrite( %obj, <span class="stringliteral">&quot;stuff.txt&quot;</span>, xml );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in Binary.</span></div>
<div class="line">TamlWrite( %obj, <span class="stringliteral">&quot;stuff.dat1&quot;</span>, binary );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write it out in Binary (with compression off).</span></div>
<div class="line">TamlWrite( %obj, <span class="stringliteral">&quot;stuff.dat2&quot;</span>, binary, <span class="keyword">false</span> );</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md34"></a>
Writing Defaults</h2>
<p>When TAML determines that it needs to write out an object it checks each field to see if it should be written or not. It does this internally using a mechanism that allows a type to say whether it currently wants to write the field or not. In nearly all cases this decision is simply based upon whether the field is at its default or not.</p>
<p>You can control whether TAML asks this question or not or put another way, whether it simply writes out all fields or only the ones that are not at their defaults.</p>
<p>Writing out fields that are at their defaults results in larger files which are slower to read. Also, setting fields that are already at their default when reading is a waste of time. Some may prefer to have all the available fields for an object written out, sometimes used as a crude way of knowing what is available but this is not only an expensive way of doing things, it's also confusing to interpret because it's not easy to see how one object is configured differently than another as all fields are written.</p>
<p>If you do wish to write all fields that are at defaults, you can control it using the following:</p>
<ul>
<li>setWriteDefaults(true/false)</li>
<li>getWriteDefaults()</li>
<li>"WriteDefaults" field.</li>
</ul>
<p>By default, writing defaults is off.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Progenitor Update</h2>
<p>When you generate an instance of any type in TorqueScript, the instance is flagged with the filename of the script that created it. <br  />
</p>
<p>For instance, let's say the following method is called and is compiled in the file "\T2D\foo.cs":</p>
<div class="fragment"><div class="line">function bar()</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">    # Create a sprite (this could be any SimObject).</span></div>
<div class="line">    %sprite = <span class="keyword">new</span> <a class="code hl_class" href="class_sprite.html">Sprite</a>();</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    # Echo the progenitor file.</span></div>
<div class="line">    echo( %sprite.getProgenitorFile() );</div>
<div class="line">}</div>
</div><!-- fragment --><p>The above example would output "\T2D\foo.cs" as that is the script it was created in.</p>
<p>This is extremely useful for debugging however, what does this have to do with TAML? Because TAML can generate object instances as well and those instances are not defined inside a script but inside a TAML formatted file it makes sense for TAML to update the progenitor file to refer to the TAML formatted file itself.</p>
<p>By default TAML will do this however you can control whether it does so or not using the following:</p>
<ul>
<li>setProgenitorUpdate(true/false)</li>
<li>getProgenitorUpdate()</li>
<li>"ProgenitorUpdate" field.</li>
</ul>
<p>If you turn-off progenitor updates then the progenitor file will be the last executing script that caused the TAML file to be read.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Advanced TAML</h2>
<p>The remainder of the document is more advanced and covers how TAML writes and reads state for objects. This is useful when designing types as you must always take persistence into account as part of the design. It's no good designing a type or a full system only to have to then figure out how to write and read its states afterwards.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
TAML compilation</h2>
<p>When you specify an object to write, this doesn't necessarily mean that it's the only object that will get written. This is due to the fact that various objects "own" or "contain" other objects, otherwise known as "children" objects.</p>
<p>When TAML writes an object it performs several stages of compilation:</p>
<ol type="1">
<li>Find all static and dynamic fields to write</li>
<li>Find any child objects to write</li>
<li>Find any custom state to write</li>
</ol>
<h3><a class="anchor" id="autotoc_md38"></a>
Static and Dynamic Field Compilation</h3>
<p>This stage is actually in two parts. The first part is iterating all the static fields and querying whether the field should be written or not. Note that this query is only done if the TAML option of "WriteDefaults" is not active as described previously.</p>
<p>This is done by simply using the <a class="el" href="namespace_torque.html">Torque</a> field system which allows a developer to specify for each field a setter, getter and write-field functions like so:</p>
<div class="fragment"><div class="line">addProtectedField(<span class="stringliteral">&quot;Angle&quot;</span>, TypeF32, NULL, &amp;setAngle, &amp;getAngle, &amp;writeAngle, <span class="stringliteral">&quot;&quot;</span>);</div>
</div><!-- fragment --><p>In this example, the protected field is specifying a setter, getter and write functions although combinations of these are allowed.</p>
<p>The "writeAngle" method is called by anything that needs to know if the field should be written or not. In this case it's TAML calling it. The "writeAngle" method in this example is defined as a method that determines if the angle is at its default or not.</p>
<p>TAML quickly iterates all the static fields querying this and produces a list of static fields that need writing.</p>
<p>Following this, TAML quickly iterates any dynamic fields that exist and adds them all because dynamic fields are just that, dynamic, and do not have any code related to them that can determine their meaning or if they should be written or not.</p>
<h3><a class="anchor" id="autotoc_md39"></a>
Children Object Compilation</h3>
<p>TAML will query the type to see if it implements the type <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/persistence/taml/tamlChildren.h">TamlChildren</a>. If it does then it queries how many children the object contains. It then iterates each of those children perform a full compilation on each i.e. it will check for fields, for child objects and custom state as is being described here.</p>
<p>This is the key to how writing a single object produces multiple objects being written. This only occurs for types that have been specifically written to do this by implementing the "TamlChildren" type. Notable types that do this are <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/sim/simSet.h">SimSet</a> which can contain as many other <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/sim/simObject.h">SimObject</a> as required and <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/2d/scene/Scene.h">Scene</a> which contains <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/2d/sceneobject/SceneObject.h">SceneObject</a>.</p>
<p>The <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/sim/simSet.h">SimSet</a> type is particularly useful as it allows you to persist a generic list of objects like so:</p>
<div class="fragment"><div class="line">%list = <span class="keyword">new</span> <a class="code hl_class" href="class_sim_set.html">SimSet</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add some objects.</span></div>
<div class="line">%list.add( <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>() );</div>
<div class="line">%list.add( <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>() );</div>
<div class="line">%list.add( <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>() );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write out the list.</span></div>
<div class="line">TamlWrite( %list, <span class="stringliteral">&quot;list.taml&quot;</span> );</div>
<div class="ttc" id="aclass_script_object_html"><div class="ttname"><a href="class_script_object.html">ScriptObject</a></div><div class="ttdef"><b>Definition</b> scriptObject.h:41</div></div>
<div class="ttc" id="aclass_sim_set_html"><div class="ttname"><a href="class_sim_set.html">SimSet</a></div><div class="ttdef"><b>Definition</b> simSet.h:102</div></div>
</div><!-- fragment --><p>... which produces the following XML output:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">SimSet</span>&gt;</div>
<div class="line">   &lt;<span class="keywordtype">ScriptObject</span>/&gt;</div>
<div class="line">   &lt;<span class="keywordtype">ScriptObject</span>/&gt;</div>
<div class="line">   &lt;<span class="keywordtype">ScriptObject</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">SimSet</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md40"></a>
Custom State</h3>
<p>When designing types you can simply expose state using Torques field system as long as the order at which fields are set is not critical. If that serves your purposes then you do not need to perform any special work.</p>
<p><em>WIP</em></p>
<h2><a class="anchor" id="autotoc_md41"></a>
XML Format</h2>
<p>Whilst the Binary format is difficult to describe and is not intended for editing anyway, the XML format is easy to describe and is intended for editing.</p>
<p>As an example, here's a basic structure set up in the scripts:</p>
<div class="fragment"><div class="line">%bookList = <span class="keyword">new</span> <a class="code hl_class" href="class_sim_set.html">SimSet</a>()</div>
<div class="line">{</div>
<div class="line">    Title=<span class="stringliteral">&quot;My Book List&quot;</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Blatantly obvious advert: http://www.packtpub.com/torque-3d-game-development-cookbook/book</span></div>
<div class="line">%book1 = <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>()</div>
<div class="line">{</div>
<div class="line">    Title=<span class="stringliteral">&quot;Torque 3D Game Development Cookbook&quot;</span>;</div>
<div class="line">    Author=<span class="stringliteral">&quot;Dave Wyand&quot;</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">%book2 = <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>()</div>
<div class="line">{</div>
<div class="line">    Title=<span class="stringliteral">&quot;Graphics Programming Black Book (Special Edition)&quot;</span>;</div>
<div class="line">    Author=<span class="stringliteral">&quot;Michael Abrash&quot;</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">%book3 = <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>()</div>
<div class="line">{</div>
<div class="line">    Title=<span class="stringliteral">&quot;Programming with Graphics&quot;</span>;</div>
<div class="line">    Author=<span class="stringliteral">&quot;Garry Marshall&quot;</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">%bookList.add( %book1 );</div>
<div class="line">%bookList.add( %book2 );</div>
<div class="line">%bookList.add( %book3 );</div>
<div class="line"> </div>
<div class="line">TamlWrite( %bookList, <span class="stringliteral">&quot;booklist.taml&quot;</span> );</div>
</div><!-- fragment --><p>This produces the following in XML format:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">SimSet</span></div>
<div class="line">    <span class="keyword">Title</span>=<span class="stringliteral">&quot;My Book List&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ScriptObject</span></div>
<div class="line">        <span class="keyword">Title</span>=<span class="stringliteral">&quot;Torque 3D Game Development Cookbook&quot;</span></div>
<div class="line">        <span class="keyword">Author</span>=<span class="stringliteral">&quot;Dave Wyand&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ScriptObject</span></div>
<div class="line">        <span class="keyword">Title</span>=<span class="stringliteral">&quot;Graphics Programming Black Book (Special Edition)&quot;</span></div>
<div class="line">        <span class="keyword">Author</span>=<span class="stringliteral">&quot;Michael Abrash&quot;</span>/&gt;               </div>
<div class="line">    &lt;<span class="keywordtype">ScriptObject</span></div>
<div class="line">        <span class="keyword">Title</span>=<span class="stringliteral">&quot;Programming with Graphics&quot;</span></div>
<div class="line">        <span class="keyword">Author</span>=<span class="stringliteral">&quot;Garry Marshall&quot;</span>/&gt;               </div>
<div class="line">&lt;/<span class="keywordtype">SimSet</span>&gt;</div>
</div><!-- fragment --><p>The XML schema used here is pretty simple. Each <a href="http://www.w3schools.com/xml/xml_elements.asp">XML element</a> represents an engine type to be created. Each <a href="http://www.w3schools.com/xml/xml_attributes.asp">XML attribute</a> represents a field to be set. The field might be a static or dynamic <a class="el" href="namespace_torque.html">Torque</a> field, both are represented by the fields' name only.</p>
<p>The relative position of each XML element is also important as the XML file represents an <a href="http://www.w3schools.com/xml/xml_tree.asp">XML Tree</a>. The root element is the object which was originally written and is the object that will be returned when the file is subsequently read again.</p>
<p>XML Elements that appear as children of other XML elements are indeed children objects and are added to the parent object. As seen in previous examples, the parent object might be a <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/2d/scene/Scene.h">Scene</a> or in this example a <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/sim/simSet.h">SimSet</a>.</p>
<p>TAML also supports object referencing allow the same object to be referenced more than once inside a TAML file.</p>
<p>For instance, let's say we did this:</p>
<div class="fragment"><div class="line">%list = <span class="keyword">new</span> <a class="code hl_class" href="class_sim_set.html">SimSet</a>();</div>
<div class="line"> </div>
<div class="line">%obj = <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>();</div>
<div class="line">%list.add( %obj );</div>
<div class="line">%list.add( %obj );</div>
<div class="line">%list.add( %obj );</div>
<div class="line"> </div>
<div class="line">TamlWrite( %list, <span class="stringliteral">&quot;list.taml&quot;</span> );</div>
</div><!-- fragment --><p>In this example, we add the same object several times to the parent object. This produces the following XML format:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">SimSet</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ScriptObject</span> <span class="keyword">TamlId</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ScriptObject</span> <span class="keyword">TamlRefId</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ScriptObject</span> <span class="keyword">TamlRefId</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">SimSet</span>&gt;</div>
</div><!-- fragment --><p>What this example shows are two new fields of "TamlId" and "TamlRefId". These fields represent an automatically assigned object Id and a reference to an automatically assigned object Id respectively.</p>
<p>The output format associates the first occurance of the object with its automatically assigned Id using TamlId="1". This establishes the identity of this object. If any subsequent XML elements refer to this object then they use TamlRefId="1". This informs TAML to NOT create a new instance of the type but to simply use the reference to the previously created one.</p>
<p>In the above example, this causes the first "ScriptObject" type to be created and added to the "SimSet" then the following two occurences of "ScriptObject" are treated as simply references to the first "ScriptObject" created and these are added to the "SimSet" resulting in a "SimSet" listing three of the same object.</p>
<p>The actual Id used here is not available on the "ScriptObject" (or any other object involved) as it is completely dealt with by TAML itself. The actual values used for Ids are not important (apart from being &gt;0), simply that any Ids and references to Ids match up appropriately.</p>
<h3><a class="anchor" id="autotoc_md42"></a>
Named Objects</h3>
<p>TAML will quite happily persist named <a class="el" href="namespace_torque.html">Torque</a> objects however you must take extreme care when doing so because it is very easy to read such TAML files more than once causing previously named objects to be left orphaned.</p>
<p>Writing a named object simply causes the "Name" field to be written like so:</p>
<div class="fragment"><div class="line">TamlWrite( <span class="keyword">new</span> <a class="code hl_class" href="class_script_object.html">ScriptObject</a>(Fred), <span class="stringliteral">&quot;test.taml&quot;</span> );</div>
</div><!-- fragment --><div class="fragment"><div class="line">&lt;<span class="keywordtype">ScriptObject</span> <span class="keyword">Name</span>=<span class="stringliteral">&quot;Fred&quot;</span>/&gt;</div>
</div><!-- fragment --><p>When this is first read it produces a "ScriptObject" with the name "Fred" however, if it was read again then the original object known solely by the name "Fred" would be lost, replaced by the newly named object.</p>
<p>Whilst this global namespace for <a class="el" href="namespace_torque.html">Torque</a> objects is very useful, especially for GUI files, careful consideration to persisting such objects should be taken.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
TAML Callbacks</h2>
<p>TAML provides a <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/persistence/taml/tamlCallbacks.h">TamlCallbacks</a> type which defines all the callbacks that TAML will perform on any object being written or read. This type is implemented by <a href="https://github.com/GarageGames/Torque2D/blob/master/engine/source/sim/simObject.h">SimObject</a> so is available to every object that TAML can process.</p>
<p>Each callback is virtual therefore allowing any derived type to hook into the callback but you must always ensure that you additionally call the parent type.</p>
<p>The callbacks and their meaning as as follows:</p>
<ul>
<li>onTamlPreWrite() - Called prior to TAML writing the object.</li>
<li>onTamlPostWrite() - Called after TAML has finished writing the object.</li>
<li>onTamlPreRead() - Called prior to TAML reading the objects state.</li>
<li>onTamlPostRead() - Called after TAML has read the objects state.</li>
<li>onTamlAddParent() - Called after 'onTamlPostRead()' and has added the object to a parent object i.e. it is a child.</li>
<li>onTamlCustomWrite() - Called during the writing of the object to allow custom properties to be written.</li>
<li>onTamlCustomRead() - Called during the reading of the object to allow custom properties to be read.</li>
</ul>
<p>Whilst these callbacks can be used for almost any purpose, they do have some typical uses.</p>
<p>The "onTamlPreWrite()" and "onTamlPostWrite()" can be used for preparation of an object prior to writing and post-write clean-up. This kind of work should be avoided so as to not cause side-effects during writing but it can be useful in certain circumstances.</p>
<p>The "onTamlPostRead()" and "onTamlAddParent()" can useful when some specific initialization is required after reading or adding to a parent. Again, this should be avoided as the need for some specific initialization actions after the state has been set isn't a good design configuration but can be useful in certain circumstances. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
